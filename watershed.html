<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Virtual Watershed Adaptor &mdash; Virtual Watershed Documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/vwlogo_grey_favicon-32.png"/>
    <link rel="top" title="Virtual Watershed Documentation" href="index.html" />
    <link rel="next" title="(iSNOBAL) modeling with NetCDF" href="isnobal_netcdf.html" />
    <link rel="prev" title="Python API for the Virtual Watershed" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="isnobal_netcdf.html" title="(iSNOBAL) modeling with NetCDF"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Python API for the Virtual Watershed"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">VW Info</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="virtual-watershed-adaptor">
<span id="watershed-main"></span><h1>Virtual Watershed Adaptor<a class="headerlink" href="#virtual-watershed-adaptor" title="Permalink to this headline">¶</a></h1>
<p>These tools help the user connect to the Virtual Watershed Data API. For more
information, see the Data API docs at <a class="reference external" href="http://vwp-dev.unm.edu/docs/index.html">http://vwp-dev.unm.edu/docs/index.html</a>.</p>
<div class="section" id="vwclient-user-interface-to-the-virtual-watershed">
<h2>VWClient: User Interface to the Virtual Watershed<a class="headerlink" href="#vwclient-user-interface-to-the-virtual-watershed" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">VWClient</span></code> performs several routine virtual watershed functions. The
first, performed in the constructor, is for authentication.
There two <code class="docutils literal"><span class="pre">search</span></code> methods, <code class="docutils literal"><span class="pre">dataset_search</span></code> and <code class="docutils literal"><span class="pre">modelrun_search</span></code>.
There are obvious <code class="docutils literal"><span class="pre">download</span></code> and <code class="docutils literal"><span class="pre">upload</span></code> functions. To create a model run,
this class provides the <code class="docutils literal"><span class="pre">initialize_modelrun</span></code> method.
An <code class="docutils literal"><span class="pre">insert_metadata</span></code> function pushes JSON watershed metadata to the
database. For deleteing model runs, use <code class="docutils literal"><span class="pre">delete_modelrun</span></code>.</p>
<dl class="class">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient">
<em class="property">class </em><code class="descclassname">wcwave_adaptors.wcwave_adaptors.watershed.</code><code class="descname">VWClient</code><span class="sig-paren">(</span><em>host_url</em>, <em>uname</em>, <em>passwd</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient" title="Permalink to this definition">¶</a></dt>
<dd><p>Client class for interacting with a Virtual Watershed (VW). A VW
is essentially a structured database with certain rules for its
metadata and for uploading or inserting data.</p>
<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.create_new_user">
<code class="descname">create_new_user</code><span class="sig-paren">(</span><em>userid</em>, <em>first_name</em>, <em>last_name</em>, <em>email</em>, <em>password</em>, <em>address1</em>, <em>address2</em>, <em>city</em>, <em>state</em>, <em>zipcode</em>, <em>tel_voice</em>, <em>country='USA'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.create_new_user"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.create_new_user" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a new virtual watershed user. This is only available to users
with admin status on the virtual waterhsed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(bool) True if succesful, False if not</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.dataset_search">
<code class="descname">dataset_search</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.dataset_search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.dataset_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Search the VW for JSON metadata records with matching parameters.
Use key, value pairs as specified in the <a class="reference external" href="http://vwp-dev.unm.edu/docs/stable/search.html#search-objects">Virtual Watershed
Documentation</a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(QueryResult) A query result, containing total records matching,
the number of results returned (subtotal), and the records
themselves, which is a list of dict.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.delete_modelrun">
<code class="descname">delete_modelrun</code><span class="sig-paren">(</span><em>model_run_uuid</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.delete_modelrun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.delete_modelrun" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete a model run associated with model_run_uuid</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(bool) True if successful, False if not</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.download">
<code class="descname">download</code><span class="sig-paren">(</span><em>url</em>, <em>out_file</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.download"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.download" title="Permalink to this definition">¶</a></dt>
<dd><p>Download a file from the VW using url to out_file on local disk</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal"><span class="pre">AssertionError</span></code> &#8211;
assert that the status code from downloading is 200</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.initialize_modelrun">
<code class="descname">initialize_modelrun</code><span class="sig-paren">(</span><em>model_run_name=None</em>, <em>description=None</em>, <em>researcher_name=None</em>, <em>keywords=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.initialize_modelrun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.initialize_modelrun" title="Permalink to this definition">¶</a></dt>
<dd><p>Iniitalize a new model run.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>model_run_name</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; is the name for the new model run</li>
<li><strong>description</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; a description of the new model run</li>
<li><strong>researcher_name</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; contact person for the model run</li>
<li><strong>keywords</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; comma-separated list of keywords associated with
model run</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(str) a newly-intialized model_run_uuid</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.insert_metadata">
<code class="descname">insert_metadata</code><span class="sig-paren">(</span><em>watershed_metadata</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.insert_metadata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.insert_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert metadata to the virtual watershed. The data that gets
uploaded is the FGDC XML metadata.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(requests.Response) Returned so that the user may inspect
the response.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.modelrun_search">
<code class="descname">modelrun_search</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.modelrun_search"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.modelrun_search" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of model runs in the database. Currently no actual &#8220;search&#8221;
(see, e.g. dataset_search) is available from the Virtual Watershed
Data API.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">(QueryResult) A query result, containing total records matching,
the number of results returned (subtotal), and the records
themselves, which is a list of dict.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.swift_upload">
<code class="descname">swift_upload</code><span class="sig-paren">(</span><em>model_run_uuid</em>, <em>data_file_path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.swift_upload"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.swift_upload" title="Permalink to this definition">¶</a></dt>
<dd><p>Use the Swift client from openstack to upload data.
(<a class="reference external" href="http://docs.openstack.org/cli-reference/content/swiftclient_commands.html">http://docs.openstack.org/cli-reference/content/swiftclient_commands.html</a>)
Seems to outperform &#8216;native&#8217; watershed uploads via HTTP.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><strong>requests.HTTPError if the file cannot be successfully uploaded</strong> &#8211;</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.VWClient.upload">
<code class="descname">upload</code><span class="sig-paren">(</span><em>model_run_uuid</em>, <em>data_file_path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#VWClient.upload"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.VWClient.upload" title="Permalink to this definition">¶</a></dt>
<dd><p>Upload data for a given model_run_uuid to the VW</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal"><span class="pre">requests.HTTPError</span></code> &#8211;
if the file cannot be successfully uploaded</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p>Typically there will be no need to directly use the constructor to create a new
<code class="docutils literal"><span class="pre">VWClient</span></code> instance. Instead use this convenience function that will read
<code class="docutils literal"><span class="pre">default.conf</span></code> and establish a connection with</p>
<dl class="function">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.default_vw_client">
<code class="descclassname">wcwave_adaptors.wcwave_adaptors.watershed.</code><code class="descname">default_vw_client</code><span class="sig-paren">(</span><em>config_file=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#default_vw_client"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.default_vw_client" title="Permalink to this definition">¶</a></dt>
<dd><p>Use the credentials in config_file to initialize a new VWClient instance</p>
<p>Returns: VWClient connected to the ip address given in config_file</p>
</dd></dl>

<div class="section" id="vw-client-examples">
<h3>VW Client Examples<a class="headerlink" href="#vw-client-examples" title="Permalink to this headline">¶</a></h3>
<p>Assuming you have properly filled out your <code class="docutils literal"><span class="pre">default.conf</span></code> file with the
IP address of the watershed and your login information, you can do the
following.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">wcwave_adaptors</span> <span class="kn">import</span> <span class="n">default_vw_client</span>

<span class="n">vw_client</span> <span class="o">=</span> <span class="n">default_vw_client</span><span class="p">()</span>

<span class="c"># get the first model_run_uuid returned from the model run search</span>
<span class="n">model_run_uuid</span> <span class="o">=</span> <span class="n">vw_client</span><span class="o">.</span><span class="n">modelrun_search</span><span class="p">()</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Model Run UUID&#39;</span><span class="p">]</span>

<span class="c"># get a QueryResult that contains the total records, subtotal returned</span>
<span class="c"># with the query, and a list of the records themselves</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">vwClient</span><span class="o">.</span><span class="n">dataset_search</span><span class="p">(</span><span class="n">model_run_uuid</span><span class="o">=</span><span class="n">modelRunUUID</span><span class="p">)</span>
<span class="n">total_records_available</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">total</span>
<span class="n">records_returned_this_query</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">subtotal</span>
<span class="n">records_themselves</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">records</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">records_themselves</span><span class="p">)</span> <span class="o">==</span> <span class="n">records_returned_this_query</span>
</pre></div>
</div>
<p>The default number of results fetched (enforced by the watershed) is 15, so to
get 30, use the <code class="docutils literal"><span class="pre">limit</span></code> keyword, for example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">thirty</span> <span class="o">=</span> <span class="n">vwClient</span><span class="o">.</span><span class="n">dataset_search</span><span class="p">(</span><span class="n">model_run_uuid</span><span class="o">=</span><span class="n">model_run_uuid</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<p>When using the <code class="docutils literal"><span class="pre">VWClient.dataset_search</span></code> function, you can specify any of the
key/value pairs specified in the <a class="reference external" href="http://vwp-dev.unm.edu/docs/stable/search.html#search-objects">virtual watershed documentation</a>.</p>
<p>The search function returns a <code class="docutils literal"><span class="pre">QueryResult</span></code> instance.</p>
<dl class="class">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.QueryResult">
<em class="property">class </em><code class="descclassname">wcwave_adaptors.wcwave_adaptors.watershed.</code><code class="descname">QueryResult</code><span class="sig-paren">(</span><em>json</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#QueryResult"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.QueryResult" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents the response from the VW Data API search methods, , which gives three fields,
&#8216;total&#8217;, &#8216;subtotal&#8217;, and &#8216;records&#8217;, represented by the properties explained
in their own docstrings.</p>
<dl class="attribute">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.json">
<code class="descname">json</code><em class="property"> = None</em><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.json" title="Permalink to this definition">¶</a></dt>
<dd><p>raw json returned from the VW</p>
</dd></dl>

<dl class="attribute">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.records">
<code class="descname">records</code><em class="property"> = None</em><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.records" title="Permalink to this definition">¶</a></dt>
<dd><p>a list of the results</p>
</dd></dl>

<dl class="attribute">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.subtotal">
<code class="descname">subtotal</code><em class="property"> = None</em><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.subtotal" title="Permalink to this definition">¶</a></dt>
<dd><p>total results returned to client with the query</p>
</dd></dl>

<dl class="attribute">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.total">
<code class="descname">total</code><em class="property"> = None</em><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.QueryResult.total" title="Permalink to this definition">¶</a></dt>
<dd><p>total results available on VW</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="metadata-builders">
<h2>Metadata builders<a class="headerlink" href="#metadata-builders" title="Permalink to this headline">¶</a></h2>
<p>There are two functions for building metadata. One for creating JSON-formatted
Virtual Watershed metadata and one for generating XML-formatted FGDC &#8220;science&#8221;
metadata. The templates used to implement these functions are stored in the
<code class="docutils literal"><span class="pre">resources/</span></code> directory.</p>
<dl class="function">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.make_watershed_metadata">
<code class="descclassname">wcwave_adaptors.wcwave_adaptors.watershed.</code><code class="descname">make_watershed_metadata</code><span class="sig-paren">(</span><em>file_name</em>, <em>config</em>, <em>parent_model_run_uuid</em>, <em>model_run_uuid</em>, <em>model_set</em>, <em>watershed_name</em>, <em>state</em>, <em>fgdc_metadata=None</em>, <em>file_ext=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#make_watershed_metadata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.make_watershed_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>For a single <cite>file_name</cite>, write the corresponding Virtual Watershed JSON
metadata.</p>
<dl class="docutils">
<dt>valid kwargs:</dt>
<dd><p class="first">orig_epsg: original EPSG code of projection</p>
<p>epsg: current EPSG code</p>
<p>taxonomy: likely &#8216;file&#8217;; representation of the data</p>
<p>model_vars: variable(s) represented in the data</p>
<p>model_set: &#8216;inputs&#8217;, &#8216;outputs&#8217;, or &#8216;reference&#8217;; AssertionError if not</p>
<p>model_set_type: e.g., &#8216;binary&#8217;, &#8216;csv&#8217;, &#8216;tif&#8217;, etc.</p>
<p>model_set_taxonomy: &#8216;grid&#8217;, &#8216;vector&#8217;, etc.</p>
<p>west_bound: westernmost longitude of bounding box</p>
<p>east_bound: easternmost longitude of bounding box</p>
<p>north_bound: northernmost latitude of bounding box</p>
<p>south_bound: southernmost latitude of bounding box</p>
<p>start_datetime: datetime observations began, formatted like &#8220;2010-01-01 22:00:00&#8221;</p>
<p>end_datetime: datetime observations ended, formatted like &#8220;2010-01-01 22:00:00&#8221;</p>
<p>wms: True if wms service can and should be enabled</p>
<p>wcs: True if wcs service can and should be enabled</p>
<p>watershed_name: Name of watershed, e.g. &#8216;Dry Creek&#8217; or &#8216;Lehman Creek&#8217;</p>
<p>model_name: Name of model, if applicaple; e.g. &#8216;iSNOBAL&#8217;, &#8216;PRMS&#8217;</p>
<p>mimetype: defaults to application/octet-stream</p>
<dl class="last docutils">
<dt>file_ext: extension to be associated with the dataset; make_watershed_metadata</dt>
<dd>will take the extension of file_name if not given explicitly</dd>
<dt>fgdc_metadata: FGDC md probably created by make_fgdc_metadata; if not</dt>
<dd>given, a default version is created (see source for details)</dd>
</dl>
</dd>
</dl>
<p>Returns: JSON metadata string</p>
</dd></dl>

<dl class="function">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.make_fgdc_metadata">
<code class="descclassname">wcwave_adaptors.wcwave_adaptors.watershed.</code><code class="descname">make_fgdc_metadata</code><span class="sig-paren">(</span><em>file_name</em>, <em>config</em>, <em>model_run_uuid</em>, <em>beg_date</em>, <em>end_date</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#make_fgdc_metadata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.make_fgdc_metadata" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>For a single <cite>data_file</cite>, write the XML FGDC metadata</dt>
<dd><dl class="first last docutils">
<dt>valid kwargs:</dt>
<dd><blockquote class="first">
<div><p>proc_date: date data was processed</p>
<p>theme_key: thematic keywords</p>
<p>model: scientific model, e.g., WindNinja, iSNOBAL, PRMS, etc.</p>
<p>researcher_name: name of researcher</p>
<p>mailing_address: researcher&#8217;s mailing address</p>
<p>city: research institute city</p>
<p>state: research institute state</p>
<p>zip_code: research institute zip code</p>
<p>researcher_phone: researcher phone number</p>
<p>row_count: number of rows in dataset</p>
<p>column_count: number of columns in dataset</p>
<p>lat_res: resolution in latitude direction (meters)</p>
<p>lon_res: resolution in longitude direction (meters)</p>
<p>map_units: distance units of the map (e.g. &#8216;m&#8217;)</p>
<p>west_bound: westernmost longitude of bounding box</p>
<p>east_bound: easternmost longitude of bounding box</p>
<p>north_bound: northernmost latitude of bounding box</p>
<p>south_bound: southernmost latitude of bounding box</p>
<dl class="docutils">
<dt>file_ext: extension of file used to fill out digtinfo:formname;</dt>
<dd>if not specified, make_fgdc_metadata takes extension</dd>
</dl>
</div></blockquote>
<p class="last">Any other kwargs will be ignored</p>
</dd>
</dl>
</dd>
</dl>
<p>Returns: XML FGDC metadata string</p>
</dd></dl>

</div>
<div class="section" id="example-using-metadata-builders-and-the-vw-client">
<h2>Example using metadata builders and the VW Client<a class="headerlink" href="#example-using-metadata-builders-and-the-vw-client" title="Permalink to this headline">¶</a></h2>
<p>Here we upload a file stored at <code class="docutils literal"><span class="pre">'data/in.0001'</span></code> to the virtual watershed
and create the appropriate metadata for it. We pretend the variable names
that are represented in this file are <code class="docutils literal"><span class="pre">R_n,H,L_v_E,G,M,delta_Q</span></code>, they are
input files. This is the procedure for inserting a brand-new, parent-free
model run set of data. Soon the &#8220;initial insert&#8221; section of this will be
automated.</p>
<div class="section" id="get-a-vw-client-connection-will-soon-be-done-during-initialization">
<h3>Get a VW Client connection (will soon be done during initialization)<a class="headerlink" href="#get-a-vw-client-connection-will-soon-be-done-during-initialization" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">vw_client</span> <span class="o">=</span> <span class="n">default_vw_client</span><span class="p">(</span><span class="n">configFile</span><span class="p">)</span> <span class="c"># gets connection info from file</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize-a-new-model-run">
<h3>Initialize a new model run<a class="headerlink" href="#initialize-a-new-model-run" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">new_uuid</span> <span class="o">=</span> <span class="n">vw_client</span><span class="o">.</span><span class="n">initialize_model_run</span><span class="p">(</span><span class="n">model_run_name</span><span class="o">=</span><span class="s">&#39;iSNOBAL for Water</span>
    <span class="n">Year</span> <span class="mi">2010</span><span class="s">&#39;, description=&#39;</span><span class="nb">input</span> <span class="ow">and</span> <span class="n">output</span> <span class="n">files</span> <span class="k">for</span> <span class="n">observed</span> <span class="n">data</span> <span class="k">for</span>
    <span class="n">water</span> <span class="n">year</span> <span class="mi">2010</span><span class="s">&#39;, researcher_name=&#39;</span><span class="n">Matt</span> <span class="n">Turner</span><span class="s">&#39;,</span>
    <span class="n">keywords</span><span class="o">=</span><span class="s">&#39;isnobal,idaho&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="upload-file">
<h3>Upload File<a class="headerlink" href="#upload-file" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data_file</span> <span class="o">=</span> <span class="s">&quot;src/test/data/in.0001&quot;</span>
<span class="n">vw_client</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">new_uuid</span><span class="p">,</span> <span class="n">data_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="build-metadata">
<h3>Build metadata<a class="headerlink" href="#build-metadata" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">start_datetime</span> <span class="o">=</span> <span class="s">&#39;2010-01-01 01:00:00&#39;</span>
<span class="n">end_datetime</span> <span class="o">=</span> <span class="s">&#39;2010-01-01 02:00:00&#39;</span>

<span class="n">upl_res</span> <span class="o">=</span> <span class="n">vw_client</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">new_uuid</span><span class="p">,</span> <span class="n">input_file</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">upl_res</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">,</span> <span class="s">&quot;Error on upload!&quot;</span>

<span class="c"># now description refers to an individual metadata record</span>
<span class="n">description</span> <span class="o">=</span> <span class="s">&#39;isnobal I_lw geotiff #2&#39;</span>

<span class="n">fgdc_metadata</span> <span class="o">=</span> <span class="n">make_fgdc_metadata</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">parent_uuid</span><span class="p">,</span>
    <span class="n">start_datetime</span><span class="o">=</span><span class="n">start_datetime</span><span class="p">,</span> <span class="n">end_datetime</span><span class="o">=</span><span class="n">end_datetime</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>

<span class="n">watershed_metadata</span> <span class="o">=</span> <span class="n">metadata_from_file</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">parent_uuid</span><span class="p">,</span>
    <span class="n">new_uuid</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">watershed_name</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span>
    <span class="n">start_datetime</span><span class="o">=</span><span class="n">start_datetime</span><span class="p">,</span> <span class="n">end_datetime</span><span class="o">=</span><span class="n">end_datetime</span><span class="p">,</span>
    <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">fgdc_metadata</span><span class="o">=</span><span class="n">fgdc_metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="insert-metadata">
<h3>Insert Metadata<a class="headerlink" href="#insert-metadata" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">vw_client</span><span class="o">.</span><span class="n">insert_metadata</span><span class="p">(</span><span class="n">watershed_metadata</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="make-watershed-metadata">
<h2>Make Watershed Metadata<a class="headerlink" href="#make-watershed-metadata" title="Permalink to this headline">¶</a></h2>
<p>We could have used the <code class="docutils literal"><span class="pre">make_watershed_metadata</span></code> function, but
<code class="docutils literal"><span class="pre">metadata_from_file</span></code> helps us out, especially when inserting geotiffs and
iSNOBAL binaries, which it knows about and automatically creates appropriate
metadata in these cases.</p>
<dl class="function">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.metadata_from_file">
<code class="descclassname">wcwave_adaptors.wcwave_adaptors.watershed.</code><code class="descname">metadata_from_file</code><span class="sig-paren">(</span><em>input_file</em>, <em>parent_model_run_uuid</em>, <em>model_run_uuid</em>, <em>description</em>, <em>watershed_name</em>, <em>state</em>, <em>start_datetime=None</em>, <em>end_datetime=None</em>, <em>model_name=None</em>, <em>fgdc_metadata=None</em>, <em>model_set_type=None</em>, <em>model_set_taxonomy=None</em>, <em>water_year_start=2010</em>, <em>water_year_end=2011</em>, <em>config_file=None</em>, <em>dt=None</em>, <em>model_set=None</em>, <em>model_vars=None</em>, <em>file_ext=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#metadata_from_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.metadata_from_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate metadata for input_file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>**kwargs</strong> &#8211; Set union of kwargs from make_fgdc_metadata and
make_watershed_metadata</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">(str) watershed metadata</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="upsert">
<h3>Upsert<a class="headerlink" href="#upsert" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This works, but may soon be deprecated and will likely not be supported any
more.</p>
</div>
<p>I wrote out all of the previous steps to show what is possible with the
watershed. The function that puts this all together, though, is the <code class="docutils literal"><span class="pre">upsert</span></code>
function, which allows the user to upload and insert either a single file or a
whole directory to the virtual watershed</p>
<span class="target" id="upsert-ref"></span><dl class="function">
<dt id="wcwave_adaptors.wcwave_adaptors.watershed.upsert">
<code class="descclassname">wcwave_adaptors.wcwave_adaptors.watershed.</code><code class="descname">upsert</code><span class="sig-paren">(</span><em>input_path</em>, <em>watershed_name</em>, <em>state</em>, <em>model_run_name=None</em>, <em>description=None</em>, <em>keywords=None</em>, <em>parent_model_run_uuid=None</em>, <em>model_run_uuid=None</em>, <em>model_name=None</em>, <em>model_set_type=None</em>, <em>file_ext=None</em>, <em>config_file=None</em>, <em>dt=None</em>, <em>taxonomy='geoimage'</em>, <em>model_set_taxonomy='grid'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/wcwave_adaptors/wcwave_adaptors/watershed.html#upsert"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wcwave_adaptors.wcwave_adaptors.watershed.upsert" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Upload the file or files located at input_path, which could be a</dt>
<dd>directory. This function also creates and inserts metadata records for
every file as required by the virtual watershed.</dd>
<dt>Inputs:</dt>
<dd>input_path (str): Directorty or file to upload</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A two-tuple of parent_model_run_uuid and model_run_uuid</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(str, str)</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/vwlogo_grey_800.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Virtual Watershed Adaptor</a><ul>
<li><a class="reference internal" href="#vwclient-user-interface-to-the-virtual-watershed">VWClient: User Interface to the Virtual Watershed</a><ul>
<li><a class="reference internal" href="#vw-client-examples">VW Client Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metadata-builders">Metadata builders</a></li>
<li><a class="reference internal" href="#example-using-metadata-builders-and-the-vw-client">Example using metadata builders and the VW Client</a><ul>
<li><a class="reference internal" href="#get-a-vw-client-connection-will-soon-be-done-during-initialization">Get a VW Client connection (will soon be done during initialization)</a></li>
<li><a class="reference internal" href="#initialize-a-new-model-run">Initialize a new model run</a></li>
<li><a class="reference internal" href="#upload-file">Upload File</a></li>
<li><a class="reference internal" href="#build-metadata">Build metadata</a></li>
<li><a class="reference internal" href="#insert-metadata">Insert Metadata</a></li>
</ul>
</li>
<li><a class="reference internal" href="#make-watershed-metadata">Make Watershed Metadata</a><ul>
<li><a class="reference internal" href="#upsert">Upsert</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Python API for the Virtual Watershed</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="isnobal_netcdf.html"
                        title="next chapter">(iSNOBAL) modeling with NetCDF</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/watershed.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, Tri-State EPSCoR: WC-WAVE.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.4</a>
      
      |
      <a href="_sources/watershed.txt"
          rel="nofollow">Page source</a></li>
    </div>

    

    
  </body>
</html>